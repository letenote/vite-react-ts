import{R as e,d as a,r as t,j as o}from"./vendor-fwd-1SGvIy31.js";import{d as r}from"./Close-fwd-cAl8Tvfj.js";import{a as i}from"./index.esm-fwd-rj9UIJ_I.js";import{c as s,a as n}from"./populateString-fwd-uH2jbhuZ.js";import{s as l,n as d}from"./main-fwd--n1B72RI.js";import{C as m}from"./ComponentFormType.enum-fwd-9JVL8E6k.js";import{M as u}from"./SelectInputDialogType.type-fwd-EhrzjEHx.js";import{M as p}from"./index-fwd-x_aeOfk5.js";import{A as c,a as g}from"./API-fwd-wSBNwRC-.js";import{g as f}from"./getBudgets-fwd-KGb_xtEF.js";import{N as v}from"./index-fwd-A0-YyUGO.js";import{b}from"./index-fwd-lWyokz70.js";import{a as x,b as h,c as y}from"./DialogContent-fwd-CYcOnUyi.js";import{D as j}from"./DialogTitle-fwd-BhLgXYUL.js";import w from"./index-fwd-v2U3PscQ.js";import T from"./index-fwd-QlVXGDcN.js";import C from"./index-fwd-hPOcf5d2.js";import{b as S}from"./index-fwd-YZzHoVcr.js";import D from"./index-fwd-goasdrlS.js";const E={budgetData:{name:{id:"name",name:"name",fullWidth:!0,label:"Name",placeholder:"Name",required:!0,errorMessage:"name required",value:"",disabled:!1,type:"text",componentType:m.INPUT_TEXT,autoFocus:!0,autoComplete:"",validate:{pattern:{value:/^/,message:""}},options:[]}},detailInformation:{cost:{id:"cost",name:"cost",fullWidth:!0,label:"Cost",placeholder:"Cost",required:!0,errorMessage:"cost required",value:"",disabled:!1,type:"number",componentType:m.INPUT_NUMBER_FORMAT,autoFocus:!1,autoComplete:"",validate:{pattern:{value:/^/,message:""}},options:[]},information:{id:"information",name:"information",fullWidth:!0,label:"Information",placeholder:"Information detail",required:!0,errorMessage:"information required",value:"",disabled:!1,type:"text",componentType:m.INPUT_TEXT_AREA,autoFocus:!1,autoComplete:"",validate:{pattern:{value:/^/,message:""}},options:[]}}},B=e=>async a=>{var t,o;try{return await new Promise((e=>setTimeout(e,1e3))),await c({method:"post",url:"/v1/budgets/register",payload:e.data}),a(l({open:!0,autoHideDuration:3e3,severity:"success",message:"Budget "+(e.data.isDraft?"Save as draft":"created")})),e.successCB()}catch(r){return g.isAxiosError(r)&&r.response&&(console.log("errr",(null==(t=r.response)?void 0:t.data).error),a(l({open:!0,autoHideDuration:3e3,severity:"warning",message:(null==(o=r.response)?void 0:o.data.message)??r.message??""}))),e.failedCB()}},I=e.memo((e=>{const I=new URLSearchParams(location.search),q=parseInt(I.get("page")||"1",10),N=d(),A=a(),M=b(A.breakpoints.down("md")),P=JSON.parse(JSON.stringify(E)),k=i({defaultValues:async()=>{var a,t,o;return e.methodType===u.UPDATE&&(P.budgetData.name.value=(null==(a=e.populate)?void 0:a.name)??"",P.detailInformation.cost.value=(null==(t=e.populate)?void 0:t.cost)??"",P.detailInformation.information.value=(null==(o=e.populate)?void 0:o.information)??""),P}}),{register:F,handleSubmit:U,formState:_,control:R,getValues:O,clearErrors:W,setError:$}=k,{errors:H}=_,[J,z]=t.useState({loading:!1}),L=e=>{N(l({open:!0,autoHideDuration:2e3,severity:"warning",message:e}))};return o.jsx(o.Fragment,{children:o.jsxs(x,{component:"form",id:"budget-create-dialog",onSubmit:U((a=>{var t;z({loading:!0});const o={name:a.budgetData.name.value.toString(),isDraft:!1,cost:a.detailInformation.cost.value.toString(),information:a.detailInformation.information.value.toString()};return e.methodType===u.UPDATE?N((r={data:{...o,id:(null==(t=e.populate)?void 0:t.id)??""},successCB:()=>{e.closeEvent(),N(f({page:q}))},failedCB:()=>{z({loading:!1})}},async e=>{var a,t;try{return await new Promise((e=>setTimeout(e,1e3))),await c({method:"post",url:"/v1/budgets/update",payload:r.data}),e(l({open:!0,autoHideDuration:3e3,severity:"success",message:"Budget updated"})),r.successCB()}catch(o){return g.isAxiosError(o)&&o.response&&(console.log("errr",(null==(a=o.response)?void 0:a.data).error),e(l({open:!0,autoHideDuration:3e3,severity:"warning",message:(null==(t=o.response)?void 0:t.data.message)??o.message??""}))),r.failedCB()}})):N(B({data:o,successCB:()=>{e.closeEvent(),N(f({page:q}))},failedCB:()=>{z({loading:!1})}}));var r}),(e=>L("Please make sure all forms to be filled"))),fullScreen:M,fullWidth:!0,maxWidth:"sm",onClose:()=>{},"aria-labelledby":"budget-create-dialog",disableEscapeKeyDown:!0,open:e.open,children:[o.jsx(j,{sx:{m:0,p:2},id:"customized-dialog-title",children:`${s(e.methodType)} budget`}),o.jsx(w,{"aria-label":"close",onClick:e.closeEvent,sx:{position:"absolute",right:8,top:8,color:e=>e.palette.grey[500]},children:o.jsx(r,{})}),o.jsx(h,{dividers:!0,sx:{pb:"45px"},children:o.jsx(T,{sx:{mt:1},children:Object.keys(P).map(((e,a)=>{const t=P[e];return o.jsxs(T,{sx:{mb:5},children:[o.jsx(C,{variant:"subtitle1",gutterBottom:!0,children:n(e)}),Object.keys(t).map(((a,r)=>{var i,s;const n=t[a],l=`${e}.${a}.value`,d=null==(i=H[e])?void 0:i[a];switch(n.componentType){case m.INPUT_NUMBER_FORMAT:return o.jsx(v,{name:n.name,registerField:l,id:n.id,label:n.label,required:n.required,control:R,error:!!d,helperText:n.errorMessage,value:n.value.toString(),style:{marginLeft:0,width:"100%"},disabled:n.disabled},r);case m.INPUT_TEXT_AREA:return o.jsx(p,{name:n.name,registerField:l,id:n.id,label:n.label,required:n.required,control:R,error:!!d,helperText:n.errorMessage,value:n.value.toString(),style:{marginLeft:0,width:"100%"},options:n.options,disabled:n.disabled},r);default:return o.jsx(S,{margin:"normal",sx:{ml:{xs:0,md:0},width:{xs:"100%",md:"100%"}},fullWidth:n.fullWidth,label:`${n.label}${n.required?"*":""}`,type:n.type,autoFocus:n.autoFocus,autoComplete:n.autoComplete,...F(l,{required:{value:n.required,message:n.errorMessage},disabled:n.disabled,pattern:{value:n.validate.pattern.value,message:n.validate.pattern.message}}),error:!!d,helperText:(null==(s=null==d?void 0:d.value)?void 0:s.message)??""},r)}}))]},a)}))})}),o.jsxs(y,{children:[o.jsx(D,{loading:!1,disabled:J.loading,variant:"outlined",size:"medium",onClick:e.closeEvent,children:o.jsx(C,{variant:"button",display:"block",gutterBottom:!0,children:"Cancel"})}),e.methodType===u.CREATE&&o.jsx(D,{loading:J.loading,disabled:J.loading,onClick:()=>{if(""===O("budgetData.name.value"))return $("budgetData.name.value",{type:"required",message:"name required"}),L("Save as draft, min type budget name");W(),z({loading:!0}),N(B({data:{name:O("budgetData.name.value").toString(),cost:O("detailInformation.cost.value").toString(),information:O("detailInformation.information.value").toString(),isDraft:!0},successCB:()=>{e.closeEvent(),N(f({page:q}))},failedCB:()=>{z({loading:!1})}}))},variant:"outlined",size:"medium",children:o.jsx(C,{variant:"button",display:"block",gutterBottom:!0,children:"Save as Draft"})}),o.jsx(D,{type:"submit",loading:J.loading,disabled:J.loading,variant:"contained",size:"medium",children:o.jsx(C,{variant:"button",display:"block",gutterBottom:!0,children:e.methodType})})]})]})})}),((e,a)=>JSON.stringify(e)===JSON.stringify(a)));export{I as M};
