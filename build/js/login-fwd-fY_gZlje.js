import{s as e,a as t,o as a}from"./main-fwd--n1B72RI.js";import{A as r}from"./API-fwd-wSBNwRC-.js";import{c as n}from"./populateString-fwd-uH2jbhuZ.js";class s extends Error{}function o(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return function(e){return decodeURIComponent(atob(e).replace(/(.)/g,((e,t)=>{let a=t.charCodeAt(0).toString(16).toUpperCase();return a.length<2&&(a="0"+a),"%"+a})))}(t)}catch(a){return atob(t)}}function i(e,t){if("string"!=typeof e)throw new s("Invalid token specified: must be a string");t||(t={});const a=!0===t.header?0:1,r=e.split(".")[a];if("string"!=typeof r)throw new s(`Invalid token specified: missing part #${a+1}`);let n;try{n=o(r)}catch(i){throw new s(`Invalid token specified: invalid base64 for part #${a+1} (${i.message})`)}try{return JSON.parse(n)}catch(i){throw new s(`Invalid token specified: invalid json for part #${a+1} (${i.message})`)}}s.prototype.name="InvalidTokenError";const d=t=>async a=>{try{const e=await r({method:"post",url:"/v1/users/login",payload:{password:t.data.password,email:t.data.email}});localStorage.setItem("_token",e.data.data.token);const n=i(e.data.data.token);return c(a,n,e.data.message)}catch(n){return a(e({open:!0,autoHideDuration:3e3,severity:"warning",message:"Wrong email or password"})),t.failCB()}},c=async(r,s,o)=>{r(t({authed:!0,name:s.name,email:s.email,gender:s.gender,id:s.id,nik:s.nik,role:s.role,permissions:s.permissions,departement:s.departement}));const i=s.permissions.map((e=>{const t=e.split("/");return{isParent:1===t.length,isChild:t.length>1,name:n(t[0]),label:n(t[0]),href:`/${e}`}}));return r(e({open:!0,autoHideDuration:5e3,severity:"success",message:o})),await new Promise((e=>setTimeout(e,500))),r(a({configLoaded:!0,menus:i}))};export{d as a,i as j,c as l};
